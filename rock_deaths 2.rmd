---
title: "Rock Deaths 2"
output: html_notebook
---

```{r}
library(ggplot2)
library(stringr)
library(tidyverse)
library(lubridate)
library(rvest)
library(gender)

```

How many of the people in this list are women?  We'll try to determine gender by first name.  First we have to separate the name into pieces.  BUT, where there are three or more words in the name, which is the first name?  Joe Harmonica Watson and Wild Bill Williams both have nicknames but different positions for the first name. This is what I chose:
1.Separate name into, at most, 3 parts, starting from the left side.
2.Where the right side (first piece) is blank, take the middle piece as the first name.
3.Where the first piece has an entry, test if it is a likely name, if so, use it as the first name.



```{r}
load("deaths.rdata")
deaths<-deaths %>% separate(Name,into=c("First","Middle","Last"),fill="left",extra="merge",remove=FALSE) %>% 
  mutate(birth=as.integer(year(Date)-Age)) %>% filter(birth>1880,birth<2012)

pass1<-deaths %>% gender_df(name_col = "First",year_col = "birth")
pass2<-deaths %>% gender_df(name_col = "Middle",year_col = "birth")
sex<-bind_rows(pass1,pass2) %>% 
  unique() %>%
  transmute(First=name,gender=gender,birth=year_min)

#assign gender based on first name first, then middle
deaths<-deaths %>% left_join(sex) %>% 
  select(-First) %>% 
  rename(First=Middle) %>% 
  left_join(sex,by=c("First","birth")) %>% 
  mutate_cond(is.na(gender.x),gender.x=gender.y) %>%
  select(-gender.y) %>% 
  rename(gender=gender.x)

table(deaths$gender)
```


#Bonus analysis.  Where did they die?
```{r}
deaths3<-deaths %>% 
  separate(Location,c("neighborhood","city","state","country"),
           remove=FALSE,
           sep=", ",
           fill="left",
           extra="merge")

deaths3<-deaths3 %>% mutate_cond(country=="",country="Not Specified")
deaths3<-deaths3 %>% mutate_cond(is.na(city),city="Not Specified")
deaths3<-deaths3 %>% mutate_cond(country=="U.S.",country="USA")
deaths3<-deaths3 %>% mutate_cond(country=="U.K.",country="England")
deaths3 %>% group_by(country) %>% 
  summarise(count=n()) %>% 
  arrange(desc(count)) %>%
  .[1:12,] %>% 
  kable(format.args=list(big.mark=","))

```

This doesn't reveal any surprises.  Again, it says something about the home of rock and the location of people who submit entries to Wikipedia.  We could go further and compare these numbers to population but we wouldn't learn anything not already obvious.

What about cities?

```{r}
deaths3 %>% group_by(city) %>% 
  summarise(count=n()) %>% 
  arrange(desc(count))%>% 
  .[1:12,] %>% 
  kable(format.args=list(big.mark=","))
```
If we looked at city populations, we'd find that L.A., Nashville and Memphis have more rock musicians than population would suggest. Again, not a surprise.  It's a bit surprising to me that London is not on the list. On second thought, every English rock star I can think of moved to the U.S.  I occasionally walk by the flowers outside David Bowie's house in Manhattan.
